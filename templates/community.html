{% extends 'base.html' %}

{% load widget_tweaks %}

{% block title %}HR101 - Community{% endblock %}

{% block content %}
	<main id="community">
		<div class="max-w-7xl mt-10 px-4 sm:px-6 lg:px-8">
			<div class="text-center divide-y-2 divide-currentColor sm:divide-w-12 sm:mx-18 md:divide-w-48 md:mx-36">
				<div class="text-center">
					<p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-blue-navy sm:text-4xl">Join the Conversation</p>
					<p class="m-2 max-w-2xl text-xl text-gray-500 lg:mx-auto">Heart recovery 101 is home to an amazing community of patients, family, friends and caregivers who are here to share their experiences with heart disease and support one another. The community also includes nurses, physicians, and Abiomed staff to help answer your questions. Browse the discussion board topics, join a support group, or send us your questions directly!</p>
				</div>
				<div><br/></div>
				</div>
				<!--Buttons for when more Discussion features are available: DMs, etc.
				<div class="grid grid-cols-3 gap-5 text-blue-navy">
					<a href="#"><div class="bg-white rounded-lg shadow-lg sm:h-48 sm:w-36 sm:m-2 sm:p-3 md:h-64 md:w-64 md:m-5 md:p-5">
						<svg class="w-14 h-14" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 3a1 1 0 00-1.447-.894L8.763 6H5a3 3 0 000 6h.28l1.771 5.316A1 1 0 008 18h1a1 1 0 001-1v-4.382l6.553 3.276A1 1 0 0018 15V3z" clip-rule="evenodd"></path></svg>
						<p class="text-sm text-blue-navy font-semibold mt-4">Explore the discussion boards</p>
					</div></a>
					<a href="#"><div class="bg-white rounded-lg shadow-lg sm:h-48 sm:w-36 sm:m-2 sm:p-3 md:h-64 md:w-64 md:m-5 md:p-5">
						<svg class="w-14 h-14" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path></svg>
						<p class="text-sm text-blue-navy font-semibold mt-4">Join a Group</p>
					</div></a>
					<a href="#"><div class="bg-white rounded-lg shadow-lg sm:h-48 sm:w-36 sm:m-2 sm:p-3 md:h-64 md:w-64 md:m-5 md:p-5">
						<svg class="w-14 h-14" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>
						<p class="text-sm text-blue-navy font-semibold mt-4">Send a direct message to our team of experts</p>
					</div></a>
				</div>-->
			</div>
		</main>
		
		<div class="max-w-7xl mt-10 px-4 sm:px-6 lg:px-8">
			<div class="text-center divide-y-2 divide-currentColor sm:divide-w-12 sm:mx-18 md:divide-w-48 md:mx-36">
				<div class="text-center">
					<p class="m-2 text-3xl leading-8 font-extrabold tracking-tight text-abiomed-teal sm:text-3xl">Discussions</p>
				</div>
				<div class="text-center">
					<p class="mt-2 mb-4 text-lg leading-8 tracking-tight text-gray-500 sm:text-lg">Browse discussion boards:</p>
					<div class="flex flex-row justify-center items-center mt-2 mb-4 text-lg leading-8 tracking-tight text-gray-500 sm:text-lg">
						<form action="{% url 'search_results' %}" method="get" class="flex">
							<input class="flex border border-abiomed-teal bg-gray-50 rounded p-2" name="q" type="text" placeholder="Search...">
							<button type="submit" class="flex rounded-md shadow items-center p-2 border border-transparent text-base font-medium rounded-md text-white bg-abiomed-teal hover:bg-blue-royal"><svg class="w-6 h-6" fill="white" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg></button>
						</form>
					</div>
				</div>
			</div>

			{% for board in boards %}
				<div class="bg-gradient-to-r from-abiomed-teal via-abiomed-teal-light to-abiomed-teal h-auto w-full m-1 p-5 rounded-lg shadow-lg text-white text=3xl justify-center">
					<div class="text-2xl"><strong>{{ board.name }}</strong></div>
					
					<p class="text-lg text-shadow-md">{{ board.description }}</p>
					<p>{{ board.topics.count }} Topics</p>
					<div>
						{% for topic in board.topics.all %}
							<div class="bg-abiomed-teal-pale h-auto w-full m-1 p-2 rounded-lg text-gray-900 text=lg justify-center">

								{% for post in topic.posts.all %}

									{% if forloop.first %}
										<div id="topic{{ topic.id }}" class="show_topic_posts btn border-2 border-abiomed-teal rounded-lg p-2 m-1 hover:bg-abiomed-teal-light" ><!--add onclick="togglePosts('topic{{ topic.id }}');" for single click fix-->
											<div class="flex text-black">
												<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
												<p><strong class="text-xl">"{{ topic.subject }}"</strong> by <strong> {{ topic.starter.username }}</strong> at {{ topic.last_updated }}</p>
											</div>
											<div>
												<div class="bg-white text-black h-auto w-full m-1 p-2 rounded-lg shadow-lg text=lg" style='white-space:pre-line'>{{ post.message }}</div>
												<small>{{ topic.posts.count|add:'-1' }} Comments</small>
											</div>
										</div>
									{% endif %}
								{% endfor %}
								
								<div id="topic{{ topic.id }}posts" class="topic_posts w-full hidden">
									{% for post in topic.posts.all %}
										{% if not forloop.first %}
											<div class="flex mx-6">
												<svg class="w-6 h-6 mx-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
											</div>
											{% if post.created_by == user %}
												<div class="mx-6">
													<strong>{{ post.created_by.username }}</strong>
													<small>{{ post.created_at }}</small>
													<div id="current_post{{ post.id }}" class="bg-white h-auto w-7/8 my-2 p-2 rounded-lg shadow-lg text=lg" style='white-space:pre-line'>{{ post.message }}
														<button id="{{ post.id }}" name="post_id" value="{{ post.id }}" class="show_edit_form btn flex justify-center rounded-md shadow w-auto h-8 items-center mt-2 pb-6 border border-transparent text-base font-medium text-white bg-abiomed-teal hover:bg-blue-royal py-4 md:text-lg px-2">Edit Post</button>
													</div>
													<div id="edit_post_form{{ post.id }}" class="bg-white h-auto w-7/8 my-2 p-2 rounded-lg shadow-lg text=lg hidden">
														<form method="post" novalidate>
															{% csrf_token %}
															<div class="w-auto">
																{% include 'includes/singlefieldform.html' %}
																<input type="hidden" name="topic_id" value="{{ topic.id }}" />
																<input class="hidden" name="post_id" id="post_id{{ post.id }}" value="{{ post.id }}" />
																<input class="hidden" name="post_message" id="post_message{{ post.id }}" value="{{ post.message }}" />
																<div class="flex justify-center pt-0 pb-4">
																	<button type="submit" class="flex justify-center rounded-md shadow w-auto h-8 items-center mt-2 pb-6 border border-transparent text-base font-medium text-white bg-abiomed-teal hover:bg-blue-royal py-4 md:text-lg px-2">Save Changes</button>
																</div>

															</div>
														</form>
													</div>
												</div>
											{% else %}
												<div class="mx-6">
													<strong>{{ post.created_by.username }}</strong>
													<small>{{ post.created_at }}</small>
													<div id="current_post{{ post.id }}" class="bg-white h-auto w-7/8 my-2 p-2 rounded-lg shadow-lg text=lg" style='white-space:pre-line'>{{ post.message }}</div>
												</div>
											{% endif %}
										{% endif %}
									{% endfor %}
								</div>
								
								<div id="topic{{ topic.id }}reply" class="reply_form w-full hidden">
									{% if user.is_authenticated %}
										<form method="post" novalidate>
											{% csrf_token %}
											{% include 'includes/singlefieldform.html' %}
											<input type="hidden" name="topic_id" id="topic_id{{ topic.id }}" value="{{ topic.id }}" />
											<div class="flex justify-center w-full pt-0 pb-4">
												<button type="submit" class="flex justify-center rounded-md shadow w-24 h-8 items-center mt-2 pb-6 border border-transparent text-base font-medium text-white bg-abiomed-teal hover:bg-blue-royal py-4 md:text-lg px-2">Reply</button>
											</div>
										</form>
									{% else %}
										<p>To post a reply, please <strong><a href="{% url 'login' %}">Log In</a></strong></p>
									{% endif %}

								</div>
							</div>

						{% endfor %}
						<div class="flex justify-center">
							<div class="rounded-md shadow w-32 h-8 flex items-center justify-center mx-22 px-2 py-3 border border-abiomed-teal text-base font-medium text-white bg-abiomed-teal-dark hover:bg-blue-pale md:py-3 md:text-lg md:px-2"><a href="{% url 'new_topic' board.pk %}">New Topic</a></div>
						</div>
					</div>
				</div>
		{% endfor %}
		<!--Group listings - saving this feature for later
			<div class="mr-36 ml-36 lg:text-center divide-y-2 divide-currentColor divide-w-48">
			<div class="text-center">
				<p class="m-2 text-3xl leading-8 font-extrabold tracking-tight text-abiomed-teal sm:text-3xl">Groups</p>
			</div>
			<div class="text-center">
				<p class="mt-2 mb-4 text-lg leading-8 tracking-tight text-gray-500 sm:text-lg">Use the sliders to browse specific support or interest groups</p>
			</div>
		</div>
	</div>-->
{% endblock %}
